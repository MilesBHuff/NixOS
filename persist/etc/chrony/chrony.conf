## man 5 chrony.conf

## If possible, you should set up an NTP server on your local intranet, and have all devices connect to that — this can considerably reduce the load placed on public NTP servers.
## You should always use NTS (encrypted NTP) if possible.
## Any servers enabled in this file are sampled together. Chrony picks one as the master, but all of them contribute to your system time.
## You should never have exactly 2 timeservers, as this makes it impossible to know which is most-accurate. 1 and 4+ are optimal (though very large numbers are also bad). Use 4+ if your computer is WAN-facing or changes networks a lot; use 1 if your computer is bound to an Intranet where a local authoritative timeserver exists.
## You should avoid adding `prefer` to servers unless you have a special reason to, since chrony already prefers servers according to their evident quality.
## You should generally prefer lower-stratum servers, but make sure you don't connect to servers without permission — a lot of stratum-1 servers have restrictions.
## You should generally avoid mixing stratums, as your own stratum could change during operation and there is a risk that your higher-stratum servers may be pulling from the same lower-stratum sources you are. Mixing stratums is nevertheless defensible if you are low on local options and you know that all your sources are truly independent.
## You should prefer to use geographically-close servers, as latency matters for network time. Chrony usually has to discard distant clocks because of distance-related latency, meaning you've just wasted those upstreams' bandwidths for nothing.
## (In my testing from near Athens, GA, USA, when combining all of the below servers, chrony usually only uses the American ones and only occasionally the German ones, because distance just has that much of an impact on time quality.)
## You should generally try to prefer the servers of long-lasting organizations over those of individuals, as the latter are more-likely to suddenly disappear from existence.
## You should use timeservers from multiple organizations unless you trust a particular organization implicitly.
## Do not mix leap-smearing servers (like time.google.com) with normal servers.
## This file lists every single known NTS server that does not smear leap seconds. Yes, it's mildly upsetting how few there are.

## Use NTP servers from DHCP — usually the best decision if there are any.
# sourcedir /run/chrony-dhcp/
## Netnod, a Swedish non-profit that runs many stratum-1 servers in Sweden and graciously allows anyone in the World to get NTP from them. Amazingly, every server in this list is its own separate stratum-1 server. Netnod requests that you limit your usage to just a few devices per network.
# server gbg1.nts.netnod.se nts iburst
# server gbg2.nts.netnod.se nts iburst
# server lul1.nts.netnod.se nts iburst
# server lul2.nts.netnod.se nts iburst
# server mmo1.nts.netnod.se nts iburst
# server mmo2.nts.netnod.se nts iburst
# server sth1.nts.netnod.se nts iburst
# server sth2.nts.netnod.se nts iburst
# server sth3.nts.netnod.se nts iburst
# server sth4.nts.netnod.se nts iburst
# server svl1.nts.netnod.se nts iburst
# server svl2.nts.netnod.se nts iburst
## Anycasts to the nearest Netnod server.
# pool      nts.netnod.se nts iburst maxsources 4
## German equivalent to US NIST. Provides public stratum-1 NTP servers.
# server ptbtime1.ptb.de nts iburst
# server ptbtime2.ptb.de nts iburst
# server ptbtime3.ptb.de nts iburst
# server ptbtime4.ptb.de nts iburst
## A German university. Provides public stratum-1 NTP servers, but ratelimits them. You are not permitted to sync more than 3 computers per network.
# server ntp0.fau.de nts iburst
# server ntp3.fau.de nts iburst
## System76, a company that sells Pop!_OS computers. Provides public stratum-2 NTP servers. Has unknown stratum-1 upstreams, but it's unlikely that its American servers source European clocks.
server virginia.time.system76.com nts iburst
server ohio.time.system76.com nts iburst
server oregon.time.system76.com nts iburst
# server paris.time.system76.com nts iburst
# server brazil.time.system76.com nts iburst
## Cloudflare. Provides public stratum-3 NTP servers behind an anycast interface. Almost certainly has their own stratum-1 infrastructure, and so is unlikely to overlap with other servers — especially European ones. I've set it to only pull up to 3 sources so that Cloudflare and System76 have equal weight.
pool time.cloudflare.com nts iburst maxsources 3
## Defines the stratum for when the network is down. Configure this to be one higher than your highest-stratum upstream. When the network is up, your stratum is determined dynamically by which upstream server is your master.
local stratum 4
## Require a certain number of sources before calculating consensus.
minsources 3

## Directories
dumpdir     /var/lib/chrony/dump/
logdir      /var/log/chrony/logs/
ntsdumpdir  /var/lib/chrony/ntsdump/

## Files
driftfile   /var/lib/chrony/drift
# hwclockfile /etc/adjtime
rtcfile     /var/lib/chrony/rtc

## Records
## Save measurements and statistics on close
dumponexit
## What to log
# log all

## Performance
## Keep chronyd from swapping out of memory
lock_all

## Reliability
## Skip checking certificate times on the first clock update, in case the system's starting time is very wrong.  This should virtually ensure that we never end-up in a situation where we are unable to synchronize time, which is a significant win.  The downside is that our first connection might be compromised; but 99.99% of the time it will still be more-secure than unencrypted NTP.
nocerttimecheck 1

## RTC Updates
## Overwrite RTC only if it goes above a difference threshold.
rtcautotrim 1
## Allow the system clock to be stepped in the first four updates (which matches how many tries a burst does) if its offset is larger than 0.1 seconds (fast-enough that it shouldn't really be noticeable to users)
makestep 0.1 4

## Timezones
## Whether the RTC is UTC (It should be unless you're dual-booting Windows, in which case you should tell Windows that RTC is UTC, and also disable time syncing in Windows.)
rtconutc
## Handles leap seconds by just repeating 00:59 for two seconds, instead of by actually setting 00:60. (This is needed to avoid app breakage.)
leapsectz UTC

## Error compensation
## Networking delays
hwtimestamp *
## Errors due to temperature variation
# tempcomp TODO

## Reject insane upstreams
## 1.5s is more than enough to cover leap seconds. (The default is 3s.)
maxdistance 1.5
## 250 should be more than enough to cover bad quartz locally + remotely. (The default is 1000.)
maxupdateskew 250

## Relay (The IP ranges below are permissive because firewalling belongs in the firewall, not in arbitrary daemons.)
## Turns this computer into an NTP server (UDP/123).
# allow 0.0.0.0/0
# allow ::/0
## Allows clients to monitor the NTP server with `chronyc` (UDP/323).
# cmdallow 0.0.0.0/0
# cmdallow ::/0
## Smears leap seconds (should be disabled if you're using a smeared upstream)
smoothtime 400 0.001 leaponly
