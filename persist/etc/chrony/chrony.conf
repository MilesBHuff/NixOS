## man 5 chrony.conf

## If possible, you should set up an NTP server on your local intranet, and have all devices connect to that — this can considerably reduce the load placed on public NTP servers.
## Any servers enabled in this file are sampled together, and chrony calculates a most-likely weighted average or so from them.
## You can add `prefer` to servers if you want, but you don't really need to in most cases, since chrony already prefers lower-ping and lower-stratum servers.
## You should generally avoid connecting to stratum-1 servers without permission.
## You should have at *least* 4 different timeservers if you want chrony to be able to accurately and reliably identify outliers.  Note that having too many is also bad, though.
## You should use timeservers from multiple organizations unless you trust a particular organization implicitly.
## I try to prefer the servers of long-lasting organizations over those of individuals.
## You should prefer to use geographically-close servers, as latency matters for network time. However, there is presently a paucity of stratum-1 NTPSec servers out there in the World, and chrony is good at accounting for RTT delay.
## Generally, you should avoid mixing stratums, as there is a risk that your higher-stratum servers may be pulling from the same lower-stratum sources you are. Mixing stratums is only defensible if you know that all your sources are truly independent.
## Do not mix leap-smearing servers (like time.google.com) with normal servers. (Note: This config only lists non-smearing upstream servers.)
##
## Netnod, a Swedish non-profit that runs many stratum-1 servers in Sweden and graciously allows anyone in the World to get NTP from them. Amazingly, every server in this list is its own separate stratum-1 server. Netnod requests that you limit your usage to just a few devices per network.
server      nts.netnod.se nts iburst ## Anycasts to the nearest Netnod server.
# server gbg1.nts.netnod.se nts iburst
# server gbg2.nts.netnod.se nts iburst
# server lul1.nts.netnod.se nts iburst
# server lul2.nts.netnod.se nts iburst
# server mmo1.nts.netnod.se nts iburst
# server mmo2.nts.netnod.se nts iburst
# server sth1.nts.netnod.se nts iburst
# server sth2.nts.netnod.se nts iburst
# server sth3.nts.netnod.se nts iburst
# server sth4.nts.netnod.se nts iburst
# server svl1.nts.netnod.se nts iburst
# server svl2.nts.netnod.se nts iburst
## German equivalent to US NIST. Provides public stratum-1 NTP servers.
# server ptbtime1.ptb.de nts iburst
# server ptbtime2.ptb.de nts iburst
server ptbtime3.ptb.de nts iburst
# server ptbtime4.ptb.de nts iburst
## A German university. Provides public stratum-1 NTP servers, but ratelimits them. You are not permitted to sync more than 3 computers per network.
# server ntp0.fau.de nts iburst
# server ntp3.fau.de nts iburst
## System76, a company that sells Pop!_OS computers. Provides public stratum-2 NTP servers. Has unknown stratum-1 upstreams, but it's unlikely that its American servers source European clocks.
server virginia.time.system76.com nts iburst
# server ohio.time.system76.com nts iburst
# server oregon.time.system76.com nts iburst
# server paris.time.system76.com nts iburst
# server brazil.time.system76.com nts iburst
## Cloudflare. Provides public stratum-3 NTP servers behind an anycast interface. Almost certainly has their own stratum-1 infrastructure, and so is unlikely to overlap with other servers — especially European ones.
pool time.cloudflare.com nts iburst
## Defines the stratum for when the network is down. Configure this to be one higher than your highest-stratum upstream.
local stratum 4
## Require a certain number of sources before calculating consensus.
minsources 3

## Directories
dumpdir     /var/lib/chrony/dump/
logdir      /var/log/chrony/logs/
ntsdumpdir  /var/lib/chrony/ntsdump/

## Files
driftfile   /var/lib/chrony/drift
# hwclockfile /etc/adjtime
rtcfile     /var/lib/chrony/rtc

## Records
## Save measurements and statistics on close
dumponexit
## What to log
# log all

## Performance
## Keep chronyd from swapping out of memory
lock_all

## Reliability
## Skip checking certificate times on the first clock update, in case the system's starting time is very wrong.  This should virtually ensure that we never end-up in a situation where we are unable to synchronize time, which is a significant win.  The downside is that our first connection might be compromised; but 99.99% of the time it will still be more-secure than unencrypted NTP.
nocerttimecheck 1

## RTC Updates
## Overwrite RTC only if it goes above a difference threshold.
rtcautotrim 1
## Allow the system clock to be stepped in the first four updates (which matches how many tries a burst does) if its offset is larger than 0.1 seconds (fast-enough that it shouldn't really be noticeable to users)
makestep 0.1 4

## Timezones
## Whether the RTC is UTC (It should be unless you're dual-booting Windows, in which case you should tell Windows that RTC is UTC, and also disable time syncing in Windows.)
rtconutc
## Handles leap seconds by just repeating 00:59 for two seconds, instead of by actually setting 00:60. (This is needed to avoid app breakage.)
leapsectz UTC

## Error compensation
## Networking delays
hwtimestamp *
## Errors due to temperature variation
# tempcomp TODO

## Reject insane upstreams
## 1.5s is more than enough to cover leap seconds. (The default is 3s.)
maxdistance 1.5
## 250 should be more than enough to cover bad quartz locally + remotely. (The default is 1000.)
maxupdateskew 250

## Relay (The IP ranges below are permissive because firewalling belongs in the firewall, not in arbitrary daemons.)
## Turns this computer into an NTP server (UDP/123).
# allow 0.0.0.0/0
# allow ::/0
## Allows clients to monitor the NTP server with `chronyc` (UDP/323).
# cmdallow 0.0.0.0/0
# cmdallow ::/0
## Smears leap seconds (shouldn't really be run on clients)
# leapsecmode smoothtime
# smoothtime 400 0.001 leaponly
